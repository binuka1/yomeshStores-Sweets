<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>කඩේ තොරතුරු කළමනාකරණය</title>
  <style>
    /* Base reset */
    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: #f0f4f8;
      color: #222;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      user-select: none;
      padding-bottom: 40px;
    }
    .container {
      max-width: 960px;
      margin: 25px auto;
      padding: 0 15px;
      flex-grow: 1;
    }
    /* Header */
    .main-header {
      background-color: #1976d2;
      color: white;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgb(25 118 210 / 0.4);
      user-select: none;
    }
    .main-header h1 {
      font-size: 1.7rem;
      font-weight: 700;
    }
    .logout-btn {
      background-color: #d32f2f;
      border: none;
      padding: 10px 20px;
      font-weight: 700;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .logout-btn:hover {
      background-color: #9a2525;
    }
    /* Form styles */
    h2 {
      margin-bottom: 15px;
      color: #1976d2;
      font-weight: 700;
    }
    form {
      background: white;
      padding: 20px 25px;
      border-radius: 14px;
      box-shadow: 0 6px 15px rgb(0 0 0 / 0.1);
      margin-bottom: 40px;
    }
    .form-row {
      margin-bottom: 18px;
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: 600;
      margin-bottom: 6px;
      color: #333;
    }
    input[type="text"],
    input[type="tel"],
    select {
      padding: 10px 14px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="tel"]:focus,
    select:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 6px rgb(25 118 210 / 0.4);
    }
    /* Buttons */
    .action-btn {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgb(25 118 210 / 0.5);
      transition: background-color 0.3s ease, transform 0.25s ease;
      user-select: none;
    }
    .action-btn:hover {
      background-color: #1565c0;
      transform: translateY(-3px);
    }
    /* Store List Table */
    .product-list-section {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 6px 15px rgb(0 0 0 / 0.1);
      border-radius: 14px;
      overflow: hidden;
    }
    thead {
      background-color: #1976d2;
      color: white;
      font-weight: 700;
      user-select: none;
    }
    th, td {
      padding: 14px 18px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      vertical-align: middle;
      font-size: 1rem;
    }
    tbody tr:hover {
      background-color: #e3f2fd;
    }
    /* Responsive Table */
    @media(max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr {
        margin-bottom: 1.5rem;
        border-radius: 14px;
        box-shadow: 0 5px 15px rgb(25 118 210 / 0.15);
        background: white;
        padding: 10px 14px;
      }
      td {
        border: none;
        position: relative;
        padding-left: 50%;
        font-size: 0.95rem;
      }
      td::before {
        position: absolute;
        left: 18px;
        top: 14px;
        white-space: nowrap;
        font-weight: 700;
        color: #1976d2;
      }
      td[data-label="කඩේ නම"]::before { content: "කඩේ නම"; }
      td[data-label="වර්ගය"]::before { content: "වර්ගය"; }
      td[data-label="දුරකථන අංකය"]::before { content: "දුරකථන අංකය"; }
      td[data-label="ක්‍රියා"]::before { content: "ක්‍රියා"; }
      td button {
        margin: 5px 5px 0 0;
      }
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1050;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      user-select: none;
    }
    .modal-content {
      background-color: #fff;
      margin: 80px auto;
      padding: 25px 30px;
      border-radius: 14px;
      width: 90%;
      max-width: 480px;
      box-shadow: 0 10px 25px rgb(0 0 0 / 0.3);
      position: relative;
      user-select: text;
    }
    .close-btn {
      color: #888;
      font-size: 28px;
      font-weight: 700;
      position: absolute;
      top: 15px;
      right: 18px;
      cursor: pointer;
      user-select: none;
      transition: color 0.3s ease;
    }
    .close-btn:hover {
      color: #d32f2f;
    }
  </style>
</head>
<body>
  <header class="main-header">
    <h1>කඩේ තොරතුරු කළමනාකරණය</h1>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </header>

  <main class="container">
    <!-- Add Store Form -->
    <section class="add-product-section">
      <h2>නව කඩේ එක් කරන්න</h2>
      <form id="addStoreForm">
        <div class="form-row">
          <label for="storeName">කඩේ නම</label>
          <input type="text" id="storeName" name="storeName" required />
        </div>

        <div class="form-row">
          <label for="storeType">කඩේ වර්ගය</label>
          <select id="storeType" name="storeType" required>
            <option value="">-- තෝරන්න --</option>
            <option value="Thoga">තොග කඩේ</option>
            <option value="Sillara">සිල්ලර කඩේ</option>
          </select>
        </div>

        <div class="form-row">
          <label for="storePhone">දුරකථන අංකය (අනවශ්‍ය නම් හිස් හැරිය හැක)</label>
          <input type="tel" id="storePhone" name="storePhone" pattern="[0-9+()\-\s]*" placeholder="0712345678" />
        </div>

        <button type="submit" class="action-btn">කඩේ එකතු කරන්න</button>
      </form>
    </section>

    <!-- Store List -->
    <section class="product-list-section">
      <h2>කඩේ ලැයිස්තුව</h2>
      <table class="responsive-table" id="storeTable">
        <thead>
          <tr>
            <th>කඩේ නම</th>
            <th>වර්ගය</th>
            <th>දුරකථන අංකය</th>
            <th>ක්‍රියා</th>
          </tr>
        </thead>
        <tbody id="storeTableBody">
          <!-- Stores dynamically loaded here -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- Edit Store Modal -->
  <div id="editModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
    <div class="modal-content">
      <span class="close-btn" id="closeEditModal" aria-label="Close modal">&times;</span>
      <h2 id="modalTitle">කඩේ තොරතුරු සකස් කරන්න</h2>
      <form id="editStoreForm">
        <div class="form-row">
          <label for="editStoreName">කඩේ නම</label>
          <input type="text" id="editStoreName" name="editStoreName" required />
        </div>

        <div class="form-row">
          <label for="editStoreType">කඩේ වර්ගය</label>
          <select id="editStoreType" name="editStoreType" required>
            <option value="">-- තෝරන්න --</option>
            <option value="Thoga">තොග කඩේ</option>
            <option value="Sillara">සිල්ලර කඩේ</option>
          </select>
        </div>

        <div class="form-row">
          <label for="editStorePhone">දුරකථන අංකය (අනවශ්‍ය නම් හිස් හැරිය හැක)</label>
          <input type="tel" id="editStorePhone" name="editStorePhone" pattern="[0-9+()\-\s]*" placeholder="0712345678" />
        </div>

        <button type="submit" class="action-btn">සුරකින්න</button>
      </form>
    </div>
  </div>

  <script>
  const addStoreForm = document.getElementById('addStoreForm');
const storeTableBody = document.getElementById('storeTableBody');

const editModal = document.getElementById('editModal');
const closeEditModalBtn = document.getElementById('closeEditModal');
const editStoreForm = document.getElementById('editStoreForm');

const logoutBtn = document.getElementById('logoutBtn');

let stores = [];
let editIndex = null;

function loadStores() {
  const storedStores = localStorage.getItem('stores');
  stores = storedStores ? JSON.parse(storedStores) : [];
  renderStoreTable();
}

function saveStores() {
  localStorage.setItem('stores', JSON.stringify(stores));
}

function renderStoreTable() {
  storeTableBody.innerHTML = '';

  if (stores.length === 0) {
    storeTableBody.innerHTML = `<tr><td colspan="4" style="text-align:center; padding: 20px;">කිසිඳු කඩේ නොමැත</td></tr>`;
    return;
  }

  stores.forEach((store, index) => {
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td data-label="කඩේ නම">${store.storeName}</td>
      <td data-label="වර්ගය">${store.storeType}</td>
      <td data-label="දුරකථන අංකය">${store.storePhone || '-'}</td>
      <td data-label="ක්‍රියා">
        <button class="action-btn" style="background-color:#388e3c; margin-right:8px;" onclick="openEditModal(${index})">සකසන්න</button>
        <button class="action-btn" style="background-color:#d32f2f;" onclick="deleteStore(${index})">මකන්න</button>
      </td>
    `;

    storeTableBody.appendChild(tr);
  });
}

function deleteStore(index) {
  if (confirm('මෙම කඩේ මකන්නද?')) {
    stores.splice(index, 1);
    saveStores();
    renderStoreTable();
  }
}

function openEditModal(index) {
  editIndex = index;
  const store = stores[index];
  editStoreForm.editStoreName.value = store.storeName;
  editStoreForm.editStoreType.value = store.storeType;
  editStoreForm.editStorePhone.value = store.storePhone || '';
  editModal.style.display = 'block';
  editModal.setAttribute('aria-hidden', 'false');
  editStoreForm.editStoreName.focus();
}

function closeEditModal() {
  editModal.style.display = 'none';
  editModal.setAttribute('aria-hidden', 'true');
  editIndex = null;
}

closeEditModalBtn.addEventListener('click', closeEditModal);

window.addEventListener('click', e => {
  if (e.target === editModal) {
    closeEditModal();
  }
});

editStoreForm.addEventListener('submit', e => {
  e.preventDefault();

  const updatedName = editStoreForm.editStoreName.value.trim();
  const updatedType = editStoreForm.editStoreType.value;
  const updatedPhone = editStoreForm.editStorePhone.value.trim();

  if (!updatedName || !updatedType) {
    alert('කරුණාකර සියලු අත්‍යවශ්‍ය තොරතුරු ඇතුළත් කරන්න.');
    return;
  }

  // Update store keeping the same id
  stores[editIndex] = {
    id: stores[editIndex].id, // keep old id
    storeName: updatedName,
    storeType: updatedType,
    storePhone: updatedPhone
  };

  saveStores();
  renderStoreTable();
  closeEditModal();
});

addStoreForm.addEventListener('submit', e => {
  e.preventDefault();

  const storeName = addStoreForm.storeName.value.trim();
  const storeType = addStoreForm.storeType.value;
  const storePhone = addStoreForm.storePhone.value.trim();

  if (!storeName || !storeType) {
    alert('කරුණාකර සියලු අත්‍යවශ්‍ය තොරතුරු ඇතුළත් කරන්න.');
    return;
  }

  stores.push({
    id: 'S' + Date.now(), // assign auto ID here
    storeName,
    storeType,
    storePhone
  });

  saveStores();
  renderStoreTable();
  addStoreForm.reset();
});

logoutBtn.addEventListener('click', () => {
  localStorage.removeItem('loggedInUser');
  window.location.href = 'index.html';
});

loadStores();

// Make these globally accessible for inline onclick handlers
window.deleteStore = deleteStore;
window.openEditModal = openEditModal;
</script>
</body>
</html>
