<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>කඩේ තොරතුරු කළමනාකරණය</title>
<style>
* { box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background:#f1f5f9; min-height:100vh; color:#222; display:flex; flex-direction:column; padding-bottom:40px; user-select:none;}
.container { max-width:960px; margin:25px auto; padding:0 15px; flex-grow:1;}
.main-header { background:#1e88e5; color:#fff; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; border-radius:0 0 12px 12px; box-shadow:0 4px 12px rgb(0 0 0 / 15%);}
.main-header h1 { font-size:1.8rem; font-weight:700; }
.logout-btn { background:#e53935; border:none; padding:10px 20px; border-radius:12px; font-weight:700; color:#fff; cursor:pointer; transition:all 0.3s ease;}
.logout-btn:hover { background:#b71c1c; transform:scale(1.05);}
h2 { margin-bottom:15px; color:#1e88e5; font-weight:700; letter-spacing:0.5px;}
form { background:#fff; padding:25px 30px; border-radius:16px; box-shadow:0 8px 20px rgb(0 0 0 / 10%); margin-bottom:30px;}
.form-row { margin-bottom:18px; display:flex; flex-direction:column;}
label { font-weight:600; margin-bottom:6px; color:#333;}
input[type=text], input[type=tel], select { padding:12px 16px; border-radius:12px; border:1.5px solid #ccc; font-size:1rem; transition:border-color 0.3s ease, box-shadow 0.3s ease;}
input[type=text]:focus, input[type=tel]:focus, select:focus { outline:none; border-color:#1e88e5; box-shadow:0 0 8px rgb(30 136 229 / 40%);}
.action-btn { background:#1e88e5; color:#fff; border:none; padding:12px 28px; border-radius:12px; font-weight:700; cursor:pointer; font-size:1.1rem; box-shadow:0 6px 18px rgb(30 136 229 / 35%); transition:all 0.25s ease;}
.action-btn:hover { background:#1565c0; transform:translateY(-3px);}

/* Filter Buttons */
.filter-container { display:flex; gap:10px; overflow-x:auto; margin-bottom:10px; padding-bottom:5px;}
.filter-container button { flex-shrink:0; padding:6px 16px; border-radius:12px; border:none; cursor:pointer; font-weight:600; transition:all 0.2s ease; }
.filter-container button.active { background:#1e88e5; color:white; }

/* Search Bar */
#searchInput { width:100%; padding:10px 16px; border-radius:12px; border:1.5px solid #ccc; margin-bottom:20px; font-size:1rem; }
#searchInput:focus { outline:none; border-color:#1e88e5; box-shadow:0 0 8px rgb(30 136 229 / 40%); }

/* --- Vertical Store Card List --- */
.store-card-list { display:flex; flex-direction:column; gap:16px;}
.store-card { background:#fff; border-radius:16px; padding:18px 20px; box-shadow:0 8px 20px rgb(0 0 0 / 10%); display:flex; flex-direction:column; justify-content:space-between; position:relative; transition:all 0.2s ease;}
.store-card:hover { transform:translateY(-3px); box-shadow:0 10px 25px rgb(30 136 229 / 15%);}
.store-info { display:flex; flex-direction:column; gap:6px;}
.store-name { font-weight:700; font-size:1.1rem; color:#000; }
.store-phone { font-size:0.95rem; color:#555; margin-top:4px; cursor:pointer; text-decoration:underline; }

/* Type Tag in Corner with colors */
.store-type-tag { position:absolute; top:12px; right:12px; padding:6px 12px; border-radius:12px; font-size:0.85rem; font-weight:700; color:rgb(45, 45, 45); box-shadow:0 2px 6px rgb(0 0 0 / 20%);border: 1px solid black;}
.type-Thoga { background:#f1e2a0; }      /* Kaha */
.type-Sillara { background:#aee6eb; }   /* La Nil */
.type-Canteen { background:#a2efa7; }   /* La Thabili */

/* Horizontal Buttons */
.store-actions { margin-top:12px; display:flex; justify-content:flex-start; gap:10px; flex-wrap:wrap;}
.store-actions button { flex:1 1 48%; }

.modal { display:none; position:fixed; z-index:1050; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.55);}
.modal-content { background:#fff; margin:80px auto; padding:30px 35px; border-radius:16px; width:90%; max-width:500px; box-shadow:0 12px 28px rgb(0 0 0 / 30%); position:relative;}
.close-btn { color:#888; font-size:28px; font-weight:700; position:absolute; top:18px; right:22px; cursor:pointer; transition:all 0.3s ease;}
.close-btn:hover { color:#e53935;}

@media(max-width:600px){
  .store-card { padding:16px 18px; }
  .store-actions { flex-direction:row; flex-wrap:wrap; gap:10px; }
}
</style>
</head>
<body>
<header class="main-header">
<h1>කඩේ තොරතුරු කළමනාකරණය</h1>
<button class="logout-btn" id="logoutBtn">Logout</button>
</header>

<main class="container">
<section class="add-product-section">
<h2>නව කඩේ එක් කරන්න</h2>
<form id="addStoreForm">
  <div class="form-row">
    <label for="storeName">කඩේ නම</label>
    <input type="text" id="storeName" name="storeName" required>
  </div>
  <div class="form-row">
    <label for="storeType">කඩේ වර්ගය</label>
    <select id="storeType" name="storeType" required>
      <option value="">-- තෝරන්න --</option>
      <option value="Thoga">තොග</option>
      <option value="Sillara">සිල්ලර</option>
      <option value="Canteen">Canteen</option>
    </select>
  </div>
  <div class="form-row">
    <label for="storePhone">දුරකථන අංකය</label>
    <input type="tel" id="storePhone" name="storePhone" placeholder="0712345678" pattern="[0-9+()\-\s]*">
  </div>
  <button type="submit" class="action-btn">කඩේ එකතු කරන්න</button>
</form>
</section>

<section class="product-list-section">
<h2>කඩේ ලැයිස්තුව</h2>

<div class="filter-container" id="typeFilter">
  <button class="active" data-type="All">සියල්ල</button>
  <button data-type="Thoga">තොග</button>
  <button data-type="Sillara">සිල්ලර</button>
  <button data-type="Canteen">Canteen</button>
</div>

<input type="text" id="searchInput" placeholder="කඩේ නම අනුව සොයන්න...">

<div class="store-card-list" id="storeCardList"></div>
</section>
</main>

<div id="editModal" class="modal">
<div class="modal-content">
<span class="close-btn" id="closeEditModal">&times;</span>
<h2>කඩේ තොරතුරු සකස් කරන්න</h2>
<form id="editStoreForm">
  <div class="form-row">
    <label for="editStoreName">කඩේ නම</label>
    <input type="text" id="editStoreName" name="editStoreName" required>
  </div>
  <div class="form-row">
    <label for="editStoreType">කඩේ වර්ගය</label>
    <select id="editStoreType" name="editStoreType" required>
      <option value="">-- තෝරන්න --</option>
      <option value="Thoga">තොග</option>
      <option value="Sillara">සිල්ලර</option>
      <option value="Canteen">Canteen</option>
    </select>
  </div>
  <div class="form-row">
    <label for="editStorePhone">දුරකථන අංකය</label>
    <input type="tel" id="editStorePhone" name="editStorePhone" placeholder="0712345678" pattern="[0-9+()\-\s]*">
  </div>
  <button type="submit" class="action-btn">සුරකින්න</button>
</form>
</div>
</div>

<script>
const addStoreForm = document.getElementById('addStoreForm');
const storeCardList = document.getElementById('storeCardList');
const typeFilter = document.getElementById('typeFilter');
const searchInput = document.getElementById('searchInput');

const editModal = document.getElementById('editModal');
const closeEditModalBtn = document.getElementById('closeEditModal');
const editStoreForm = document.getElementById('editStoreForm');
const logoutBtn = document.getElementById('logoutBtn');

let stores = [];
let editIndex = null;
let currentFilter = 'All';
let searchQuery = '';

function loadStores(){
  const stored = localStorage.getItem('stores');
  stores = stored ? JSON.parse(stored) : [];
  renderStores();
}

function saveStores(){ localStorage.setItem('stores', JSON.stringify(stores)); }

function renderStores(){
  storeCardList.innerHTML='';
  const filtered = stores.filter(s => {
    const matchType = currentFilter==='All' || s.storeType===currentFilter;
    const matchSearch = s.storeName.toLowerCase().includes(searchQuery.toLowerCase());
    return matchType && matchSearch;
  });

  if(filtered.length===0){
    storeCardList.innerHTML='<p style="text-align:center;padding:20px;">කිසිඳු කඩේ නොමැත</p>';
    return;
  }

  filtered.sort((a,b)=>a.storeName.localeCompare(b.storeName,'si'));

  filtered.forEach(store=>{
    const originalIndex = stores.findIndex(s => s.id === store.id);
    const card = document.createElement('div');
    card.className='store-card';
    card.innerHTML = `
      <div class="store-info">
        <span class="store-name">${store.storeName}</span>
        <a class="store-phone" href="tel:${store.storePhone||''}">${store.storePhone||'-'}</a>
      </div>
      <div class="store-actions">
        <button class="action-btn" style="background:#43a047;" onclick="openEditModal(${originalIndex})">සකසන්න</button>
        <button class="action-btn" style="background:#e53935;" onclick="deleteStore(${originalIndex})">මකන්න</button>
      </div>
      <span class="store-type-tag type-${store.storeType}">${store.storeType==='Thoga'?'Thoga':store.storeType==='Sillara'?'Sillara':'Canteen'}</span>
    `;
    storeCardList.appendChild(card);
  });
}

function deleteStore(index){
  if(confirm('මෙම කඩේ මකන්නද?')){
    stores.splice(index,1);
    saveStores(); renderStores();
  }
}

function openEditModal(index){
  editIndex = index;
  const s = stores[index];
  editStoreForm.editStoreName.value = s.storeName;
  editStoreForm.editStoreType.value = s.storeType;
  editStoreForm.editStorePhone.value = s.storePhone||'';
  editModal.style.display='block';
  editStoreForm.editStoreName.focus();
}

function closeEditModal(){ editModal.style.display='none'; editIndex=null; }

closeEditModalBtn.addEventListener('click',closeEditModal);
window.addEventListener('click', e=>{ if(e.target===editModal) closeEditModal(); });

editStoreForm.addEventListener('submit', e=>{
  e.preventDefault();
  const uName = editStoreForm.editStoreName.value.trim();
  const uType = editStoreForm.editStoreType.value;
  const uPhone = editStoreForm.editStorePhone.value.trim();
  if(!uName||!uType){ alert('සියලු අත්‍යවශ්‍ය තොරතුරු ඇතුළත් කරන්න'); return; }
  stores[editIndex] = { id: stores[editIndex].id, storeName: uName, storeType: uType, storePhone: uPhone };
  saveStores(); renderStores(); closeEditModal();
});

addStoreForm.addEventListener('submit', e=>{
  e.preventDefault();
  const n = addStoreForm.storeName.value.trim();
  const t = addStoreForm.storeType.value;
  const p = addStoreForm.storePhone.value.trim();
  if(!n||!t){ alert('සියලු අත්‍යවශ්‍ය තොරතුරු ඇතුළත් කරන්න'); return; }
  stores.push({ id:'S'+Date.now(), storeName:n, storeType:t, storePhone:p });
  saveStores(); renderStores(); addStoreForm.reset();
});

logoutBtn.addEventListener('click',()=>{ localStorage.removeItem('loggedInUser'); window.location.href='index.html'; });

// Filter Buttons
typeFilter.addEventListener('click', e=>{
  if(e.target.tagName==='BUTTON'){
    currentFilter=e.target.dataset.type;
    Array.from(typeFilter.querySelectorAll('button')).forEach(b=>b.classList.remove('active'));
    e.target.classList.add('active');
    renderStores();
  }
});

// Search Input
searchInput.addEventListener('input', e=>{
  searchQuery=e.target.value;
  renderStores();
});

loadStores();
window.deleteStore=deleteStore;
window.openEditModal=openEditModal;
</script>
</body>
</html>
