<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stock Management</title>
  <style>
    /* Base reset */
    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: #f0f4f8;
      color: #222;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      user-select: none;
      padding-bottom: 40px;
    }
    .container {
      max-width: 960px;
      margin: 25px auto;
      padding: 0 15px;
      flex-grow: 1;
    }
    /* Header */
    .main-header {
      background-color: #1976d2;
      color: white;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 10px rgb(25 118 210 / 0.4);
      user-select: none;
    }
    .main-header h1 {
      font-size: 1.7rem;
      font-weight: 700;
    }
    .logout-btn {
      background-color: #d32f2f;
      border: none;
      padding: 10px 20px;
      font-weight: 700;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .logout-btn:hover {
      background-color: #9a2525;
    }
    /* Form styles */
    h2 {
      margin-bottom: 15px;
      color: #1976d2;
      font-weight: 700;
    }
    form {
      background: white;
      padding: 20px 25px;
      border-radius: 14px;
      box-shadow: 0 6px 15px rgb(0 0 0 / 0.1);
      margin-bottom: 40px;
    }
    .form-row {
      margin-bottom: 18px;
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: 600;
      margin-bottom: 6px;
      color: #333;
    }
    input[type="text"],
    input[type="number"],
    input[type="date"] {
      padding: 10px 14px;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 6px rgb(25 118 210 / 0.4);
    }
    /* Buttons */
    .action-btn {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgb(25 118 210 / 0.5);
      transition: background-color 0.3s ease, transform 0.25s ease;
      user-select: none;
    }
    .action-btn:hover {
      background-color: #1565c0;
      transform: translateY(-3px);
    }
    /* Product List Table */
    .product-list-section {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 6px 15px rgb(0 0 0 / 0.1);
      border-radius: 14px;
      overflow: hidden;
    }
    thead {
      background-color: #1976d2;
      color: white;
      font-weight: 700;
      user-select: none;
    }
    th, td {
      padding: 14px 18px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      vertical-align: middle;
      font-size: 1rem;
    }
    tbody tr:hover {
      background-color: #e3f2fd;
    }
    /* Responsive Table */
    @media(max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr {
        margin-bottom: 1.5rem;
        border-radius: 14px;
        box-shadow: 0 5px 15px rgb(25 118 210 / 0.15);
        background: white;
        padding: 10px 14px;
      }
      td {
        border: none;
        position: relative;
        padding-left: 50%;
        font-size: 0.95rem;
      }
      td::before {
        position: absolute;
        left: 18px;
        top: 14px;
        white-space: nowrap;
        font-weight: 700;
        color: #1976d2;
      }
      td[data-label="නිෂ්පාදන නම"]::before { content: "නිෂ්පාදන නම"; }
      td[data-label="ප්‍රමාණය"]::before { content: "ප්‍රමාණය"; }
      td[data-label="මිල (පිරිවැය)"]::before { content: "මිල (පිරිවැය)"; }
      td[data-label="කල් ඉකුත්වීම"]::before { content: "කල් ඉකුත්වීම"; }
      td[data-label="ක්‍රියා"]::before { content: "ක්‍රියා"; }
      td button {
        margin: 5px 5px 0 0;
      }
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1050;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      user-select: none;
    }
    .modal-content {
      background-color: #fff;
      margin: 80px auto;
      padding: 25px 30px;
      border-radius: 14px;
      width: 90%;
      max-width: 480px;
      box-shadow: 0 10px 25px rgb(0 0 0 / 0.3);
      position: relative;
      user-select: text;
    }
    .close-btn {
      color: #888;
      font-size: 28px;
      font-weight: 700;
      position: absolute;
      top: 15px;
      right: 18px;
      cursor: pointer;
      user-select: none;
      transition: color 0.3s ease;
    }
    .close-btn:hover {
      color: #d32f2f;
    }
  </style>
</head>
<body>
  <header class="main-header">
    <h1>Stock Management</h1>
    <button class="logout-btn" id="logoutBtn">Logout</button>
  </header>

  <main class="container">
    <!-- Add Product Form -->
    <section class="add-product-section">
      <h2>නව නිෂ්පාදනය එක් කරන්න</h2>
      <form id="addProductForm">
        <div class="form-row">
          <label for="productName">නිෂ්පාදන නම</label>
          <input type="text" id="productName" name="productName" required />
        </div>

        <div class="form-row">
          <label for="quantity">ප්‍රමාණය</label>
          <input type="number" id="quantity" name="quantity" min="1" required />
        </div>

        <div class="form-row">
          <label for="costPrice">මිල (පිරිවැය)</label>
          <input type="number" id="costPrice" name="costPrice" min="0" step="0.01" required />
        </div>

        <div class="form-row">
          <label for="expiryDate">කල් ඉකුත්වීමේ දිනය</label>
          <input type="date" id="expiryDate" name="expiryDate" required />
        </div>

        <button type="submit" class="action-btn">නිෂ්පාදනය එක් කරන්න</button>
      </form>
    </section>

    <!-- Product List Table -->
    <section class="product-list-section">
      <h2>නිෂ්පාදන ලැයිස්තුව</h2>
      <table class="responsive-table" id="productTable">
        <thead>
          <tr>
            <th>නිෂ්පාදන නම</th>
            <th>ප්‍රමාණය</th>
            <th>මිල (පිරිවැය)</th>
            <th>කල් ඉකුත්වීම</th>
            <th>ක්‍රියා</th>
          </tr>
        </thead>
        <tbody id="productTableBody">
          <!-- Products added dynamically -->
        </tbody>
      </table>
    </section>
  </main>

  <!-- Edit Product Modal -->
  <div id="editModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="modalTitle" aria-modal="true">
    <div class="modal-content">
      <span class="close-btn" id="closeEditModal" aria-label="Close modal">&times;</span>
      <h2 id="modalTitle">නිෂ්පාදනය සකස් කරන්න</h2>
      <form id="editProductForm">
        <div class="form-row">
          <label for="editProductName">නිෂ්පාදන නම</label>
          <input type="text" id="editProductName" name="editProductName" required />
        </div>

        <div class="form-row">
          <label for="editQuantity">ප්‍රමාණය</label>
          <input type="number" id="editQuantity" name="editQuantity" min="1" required />
        </div>

        <div class="form-row">
          <label for="editCostPrice">මිල (පිරිවැය)</label>
          <input type="number" id="editCostPrice" name="editCostPrice" min="0" step="0.01" required />
        </div>

        <div class="form-row">
          <label for="editExpiryDate">කල් ඉකුත්වීමේ දිනය</label>
          <input type="date" id="editExpiryDate" name="editExpiryDate" required />
        </div>

        <button type="submit" class="action-btn">සුරකින්න</button>
      </form>
    </div>
  </div>

<script>
  // Get references
  const productForm = document.getElementById('addProductForm');
  const productTableBody = document.getElementById('productTableBody');

  const editModal = document.getElementById('editModal');
  const closeEditModalBtn = document.getElementById('closeEditModal');
  const editProductForm = document.getElementById('editProductForm');

  const logoutBtn = document.getElementById('logoutBtn');

  let products = [];
  let editIndex = null;

  // Load products from localStorage on page load
  function loadProducts() {
    const storedProducts = localStorage.getItem('products');
    products = storedProducts ? JSON.parse(storedProducts) : [];
    renderProductTable();
  }

  // Save products to localStorage
  function saveProducts() {
    localStorage.setItem('products', JSON.stringify(products));
  }

  // Render product list table
  function renderProductTable() {
    productTableBody.innerHTML = '';

    if (products.length === 0) {
      productTableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; padding: 20px;">කිසිඳු නිෂ්පාදන නොමැත</td></tr>`;
      return;
    }

    products.forEach((product, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td data-label="නිෂ්පාදන නම">${product.productName}</td>
        <td data-label="ප්‍රමාණය">${product.quantity}</td>
        <td data-label="මිල (පිරිවැය)">${product.costPrice.toFixed(2)}</td>
        <td data-label="කල් ඉකුත්වීම">${product.expiryDate}</td>
        <td data-label="ක්‍රියා">
          <button class="action-btn" onclick="openEditModal(${index})" style="background-color:#388e3c; margin-right: 8px;">සකසන්න</button>
          <button class="action-btn" onclick="deleteProduct(${index})" style="background-color:#d32f2f;">මකන්න</button>
        </td>
      `;
      productTableBody.appendChild(tr);
    });
  }

  // Delete product by index
  function deleteProduct(index) {
    if (confirm('මෙම නිෂ්පාදනය මකන්නද?')) {
      products.splice(index, 1);
      saveProducts();
      renderProductTable();
    }
  }

  // Open modal and prefill form with selected product data
  function openEditModal(index) {
    editIndex = index;
    const product = products[index];

    editProductForm.editProductName.value = product.productName;
    editProductForm.editQuantity.value = product.quantity;
    editProductForm.editCostPrice.value = product.costPrice;
    editProductForm.editExpiryDate.value = product.expiryDate;

    editModal.style.display = 'block';
    editModal.setAttribute('aria-hidden', 'false');
    editProductForm.editProductName.focus();
  }

  // Close modal
  function closeEditModal() {
    editModal.style.display = 'none';
    editModal.setAttribute('aria-hidden', 'true');
    editIndex = null;
  }

  // Close modal handlers
  closeEditModalBtn.addEventListener('click', closeEditModal);
  window.addEventListener('click', e => {
    if (e.target === editModal) closeEditModal();
  });

  // Handle edit form submission
  editProductForm.addEventListener('submit', e => {
    e.preventDefault();

    const expiryDate = editProductForm.editExpiryDate.value;
    if (new Date(expiryDate) < new Date(new Date().toISOString().split('T')[0])) {
      alert('කල් ඉකුත්වීමේ දිනය අද දිනයට හෝ පසුව යුතුය.');
      return;
    }

    const oldId = products[editIndex].id || Date.now().toString();

    products[editIndex] = {
      id: oldId,
      productName: editProductForm.editProductName.value.trim(),
      quantity: parseInt(editProductForm.editQuantity.value),
      costPrice: parseFloat(editProductForm.editCostPrice.value),
      expiryDate: expiryDate
    };

    saveProducts();
    renderProductTable();
    closeEditModal();
  });

  // Handle add product form submit
  productForm.addEventListener('submit', e => {
    e.preventDefault();

    const productName = productForm.productName.value.trim();
    const quantity = parseInt(productForm.quantity.value);
    const costPrice = parseFloat(productForm.costPrice.value);
    const expiryDate = productForm.expiryDate.value;

    if (new Date(expiryDate) < new Date(new Date().toISOString().split('T')[0])) {
      alert('කල් ඉකුත්වීමේ දිනය අද දිනයට හෝ පසුව යුතුය.');
      return;
    }

    const newProduct = {
      id: Date.now().toString(), // ✅ Unique ID
      productName,
      quantity,
      costPrice,
      expiryDate
    };

    products.push(newProduct);
    saveProducts();
    renderProductTable();
    productForm.reset();
  });

  // Logout button
  logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('loggedInUser');
    window.location.href = 'index.html';
  });

  // Initialize
  loadProducts();

  // Expose functions
  window.deleteProduct = deleteProduct;
  window.openEditModal = openEditModal;
</script>

</body>
</html>
